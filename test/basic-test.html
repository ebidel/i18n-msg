<!doctype html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
  <title>i18n-msg</title>

  <script src="../../webcomponentsjs/webcomponents.js"></script>
  <script src="../../web-component-tester/browser.js"></script>
  <script src="../../test-fixture/test-fixture-mocha.js"></script>

  <link rel="import" href="../../test-fixture/test-fixture.html">

  <!-- Step 1: import the element to test -->
  <link rel="import" href="../i18n-msg.html">
</head>
<body>

  <test-fixture id="fixture1">
    <template>
      <i18n-msg msgid="days" id="days">PLACEHOLDER_STRING</i18n-msg>
    </template>
  </test-fixture>

  <test-fixture id="fixture2">
    <template>
      <i18n-msg msgid="UNKNOWN_MSG_ID" id="days2">PLACEHOLDER_STRING</i18n-msg>
    </template>
  </test-fixture>
  
  <test-fixture id="fixture3">
    <template>
      <i18n-msg msgid="welcome" id="welcome" placeholders='["Shane","Messages"]'>PLACEHOLDER_STRING</i18n-msg>
    </template>
  </test-fixture>

  <script>

    I18nMsg.lang = 'es';
    I18nMsg.url = '../demo/locales';

    suite('<i18n-element>', function() {

      var el = fixture('fixture1');
      var expected = 'd√≠as';

      test('defines the "msgid" property', function() {
        assert.equal(el.msgid, 'days');
      });

      test('getMsg() correctly returns', function() {
        assert.equal(el.getMsg(el.msgid), expected);
        assert.equal(el.getMsg('hours'), 'horas');
        assert.equal(el.getMsg(), expected); // no args returns instance's message
      });

      test('msg property is correctly setted', function() {
        assert.equal(el.msg, expected);
      });

      test('.language property matches I18nMsg.lang', function() {
        assert.equal(el.language, I18nMsg.lang);
      });

      test('.language property is readOnly', function() {
        var val = 'bogus';
        el.language = val;
        assert.notEqual(el.language, val);
      });

      test('.textContent was updated to localize message', function() {
        assert.equal(el.textContent, expected);
      });

      test('.locales property was populated', function() {
        assert.isTrue(I18nMsg.lang in el.locales);
      });

      test('attribute replaced', function() {
        var input = document.createElement('input');
        input.placeholder = el.getMsg(el.msgid);
        assert.equal(input.placeholder, expected);
      });

    });

    suite('<i18n-element> other', function() {
      var el = fixture('fixture2');

      test('an unknown message id is not replaced', function() {
        assert.equal(el.textContent, 'PLACEHOLDER_STRING');
      });

      test('dynamically created i18n-msg', function() {
        var el2 = document.createElement('i18n-msg');
        el2.msgid = 'minutes';
        assert.equal(el2.textContent, 'minutos');
      });

    });

    suite('<i18n-element>', function() {
      var el = fixture('fixture3');

      test('uses placeholders', function() {
        assert.equal(el.textContent, 'Bienvenido Shane al mundo de la i18n Messages');
      });

      test('updates message when placeholders change', function() {
        el.set('placeholders',["John","Placeholders"]);
        assert.equal(el.textContent, 'Bienvenido John al mundo de la i18n Placeholders');
      });

    });
  </script>

</body>
</html>
